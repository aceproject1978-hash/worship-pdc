<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Calendario Worship PDC</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* =========================
   ESTILOS PRINCIPALES (ESCRITORIO) - Diseño original
   ========================= */
body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f9f9fb;color:#333;margin:15px;}
h1{text-align:center;color:#4A90E2;font-weight:700;margin-bottom:10px;text-shadow:1px 1px 2px rgba(74,144,226,0.5);user-select:none;}
.hidden{display:none;}
form,.calendar-block{width:100%;max-width:1100px;margin:0 auto 15px auto;}
table{width:100%;border-collapse:collapse;margin-top:5px;table-layout:fixed;}
table th:nth-child(1),table td:nth-child(1){width:18%;}
table th:nth-child(2),table td:nth-child(2){width:28%;}
table th:nth-child(3),table td:nth-child(3){width:12%;}
table th:nth-child(4),table td:nth-child(4){width:25%;}
table th:nth-child(5),table td:nth-child(5){width:10%;}
table th:nth-child(6),table td:nth-child(6){width:7%;}
th,td{border:1px solid #ccc;padding:5px 6px;text-align:center;vertical-align:middle;font-size:0.9em;}
th{background:linear-gradient(135deg,#4A90E2,#357ABD);color:white;font-weight:600;}
input[type=text],input[type=url],input[type=date],input[type=password],input[type=file]{width:95%;padding:4px 5px;border-radius:4px;border:1px solid #bbb;font-size:0.85em;box-sizing:border-box;}
button{background-color:#4A90E2;border:none;color:white;padding:5px 10px;font-size:0.85em;font-weight:600;border-radius:5px;cursor:pointer;transition:background-color 0.3s ease;}
button:hover{background-color:#357ABD;}
.assign-green{background-color:#28a745;color:white;font-weight:600;padding:6px 12px;border:none;border-radius:5px;cursor:pointer;transition:background-color 0.3s ease;display:block;margin:5px auto;}
.assign-green:hover{background-color:#218838;}
iframe{max-width:180px;height:90px;display:block;margin:4px auto;border-radius:6px;}
a{word-break:break-word;display:inline-block;font-size:0.8em;color:#274D87;text-decoration:none;}
a:hover{text-decoration:underline;}
.actions button{margin:2px 4px;font-size:0.75em;padding:3px 6px;border-radius:4px;}
.actions .edit{background-color:#F0AD4E;}
.actions .delete{background-color:#D9534F;}
#loginSection{max-width:360px;margin:50px auto;padding:20px;border-radius:10px;background:rgba(255,255,255,0.95);box-shadow:0 6px 20px rgba(0,0,0,0.15);border:1px solid rgba(74,144,226,0.3);text-align:center;}
#loginSection img{width:150px;margin-bottom:10px;}
#loginSection h2{margin-bottom:10px;color:#4A90E2;text-align:center;}
#errorMsg{color:#D9534F;text-align:center;margin-bottom:8px;}
.calendar-block{border:2px solid #4A90E2;border-radius:8px;background:#fff;margin-bottom:15px;box-shadow:0 0 8px rgba(74,144,226,0.1);}
.calendar-date{background:#4A90E2;color:white;padding:5px;border-radius:8px 8px 0 0;font-weight:600;text-align:center;font-size:1em;}
#loginBtn,#logoutBtn{position:absolute;top:15px;right:25px;z-index:1200;}
/* Modal backdrops (base) */
.modal-backdrop{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;
  align-items:center;justify-content:center;z-index:1000;padding:20px;box-sizing:border-box;
}
.modal-card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,0.25);box-sizing:border-box;}

/* =========================
   OVERLAY (BLACK GLASS) - fixed, centered, original colors
   ========================= */
#accessOverlay{
  position: fixed;
  inset: 0; /* top:0; right:0; bottom:0; left:0; */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: 20px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(0,0,0,0.7), rgba(0,0,0,0.85)); /* fondo oscuro */
  backdrop-filter: blur(6px);
}

/* tarjeta negra translúcida (black glass) */
.overlay-card{
  margin: 0;
  width: 100%;
  max-width: 540px;
  border-radius: 14px;
  padding: 28px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(10,10,12,0.6), rgba(6,6,8,0.45));
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  color: #fff;
  text-align: center;
  position: relative;
  overflow: hidden;
}

/* logo and title */
.overlay-card .logo{ width:220px; margin:0 auto 18px auto; display:block; }
.overlay-card h2{ margin:4px 0 14px 0; font-size:1.35rem; color:#ffd54a; }

/* buttons and inputs */
.choiceBtns{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:16px; }
.choiceBtns button{
  min-width:140px;
  padding:10px 14px;
  border-radius:10px;
  font-size:1rem;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.06);
  color: #fff;
  cursor: pointer;
}
.choiceBtns button:hover{ background: rgba(255,255,255,0.08); }

.formBox{ margin-top:8px; display:none; flex-direction:column; align-items:center; gap:8px; }
.formBox input{
  width:90%;
  padding:10px;
  border-radius:8px;
  border:none;
  background: rgba(255,255,255,0.04);
  color:#fff;
  text-align:center;
  font-size:0.95rem;
}

.smallMsg{ margin-top:8px; color:#ffb3b3; font-weight:600; min-height:18px; text-align:center; }
.closeOverlay{
  position:absolute; top:10px; right:12px;
  background:transparent; border:none;
  color:rgba(255,255,255,0.5); font-size:1.1rem;
  padding:6px; border-radius:8px; cursor:pointer;
}
.closeOverlay:hover{ color:#fff; background:rgba(255,255,255,0.03); }

/* Keep body from scrolling while overlay active */
body.overlayLocked{overflow:hidden;height:100vh;}

/* =========================
   MOBILE ADAPTACIONES
   ========================= */

/* container that allows horizontal scroll for tables on small screens */
.table-container{width:100%;overflow:auto;-webkit-overflow-scrolling:touch;}

/* Mobile tweaks */
@media (max-width:760px){
  /* Increase touch target sizes */
  button{padding:8px 10px;border-radius:8px;}
  input[type=text],input[type=url],input[type=date],input[type=file]{padding:8px 10px;border-radius:6px;font-size:0.95em;}
  .assign-green{padding:8px 10px;border-radius:8px;}
  /* make iframe placeholder smaller */
  iframe{max-width:220px;height:auto;}
}

/* On small phones use horizontal scroll rather than converting rows to cards */
@media (max-width:520px){
  /* Keep original table layout but allow scrolling horizontally */
  .table-container{overflow:auto;padding-bottom:6px;}
  table{min-width:720px;table-layout:auto;}
  th,td{padding:8px;border:1px solid #ddd;font-size:0.92em;}
  /* Replace embedded iframes in lists with thumbnails to avoid loading many iframes */
  .video-thumb{display:inline-block;width:160px;height:90px;border-radius:6px;overflow:hidden;background:#000;color:#fff;vertical-align:middle;}
  .video-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
  .play-overlay{position:relative;display:flex;align-items:center;justify-content:center;height:100%;}
  .play-btn{background:rgba(74,144,226,0.95);border:none;color:#fff;border-radius:50%;width:44px;height:44px;font-size:18px;display:flex;align-items:center;justify-content:center;}
  /* Make modal fullscreen-friendly */
  .modal-card{max-width:96%;max-height:92vh;overflow:auto;}
  /* Bigger assign button */
  .assign-green{width:100%;box-sizing:border-box;}
  /* Adjust overlay padding */
  .overlay-card{padding:18px;}
  body.overlayLocked{overflow:hidden;} /* avoid height:100vh on some mobile browsers */

  /* --- FIX: push title down a bit while overlay is active on phones --- */
  body.overlayLocked h1{
    margin-top:48px; /* ajuste para que el botón cerrar no tape el título */
  }
  /* Si prefieres empujar el modal en lugar del título, usa esta en su lugar:
     #accessOverlay{ align-items:flex-start; padding-top:44px; } */
}

/* ======= RESTAURAR DISEÑO ORIGINAL EN DESKTOP ======= */
@media (min-width: 761px) {
  body { margin:15px; overflow:auto; height:auto; }

  .table-container { overflow: visible; }
  table { width:100%; table-layout:fixed; min-width:unset; }
  th, td { padding:5px 6px; font-size:0.9em; text-align:center; vertical-align:middle; }
  table th:nth-child(1), table td:nth-child(1) { width:18%; }
  table th:nth-child(2), table td:nth-child(2) { width:28%; }
  table th:nth-child(3), table td:nth-child(3) { width:12%; }
  table th:nth-child(4), table td:nth-child(4) { width:25%; }
  table th:nth-child(5), table td:nth-child(5) { width:10%; }
  table th:nth-child(6), table td:nth-child(6) { width:7%; }

  iframe { max-width:180px; height:90px; display:block; margin:4px auto; border-radius:6px; }

  .calendar-block { border:2px solid #4A90E2; border-radius:8px; background:#fff; margin-bottom:15px; box-shadow:0 0 8px rgba(74,144,226,0.1); }
  .calendar-date { padding:5px; font-size:1em; }

  .modal-backdrop { background: rgba(0,0,0,0.4); }
  .modal-card, .overlay-card { max-width:540px; padding:28px; border-radius:10px; }
  .overlay-card .logo { width:220px; }

  button { padding:5px 10px; border-radius:5px; font-size:0.85em; }
  .assign-green { padding:6px 12px; border-radius:5px; display:block; margin:5px auto; }

  .video-thumb, .video-thumb img, .play-overlay, .play-btn { display: none !important; }
}
</style>
</head>
<body class="overlayLocked">
<h1>Calendario Worship PDC</h1>
<button id="loginBtn" class="hidden">Login</button>
<button id="logoutBtn" class="hidden">Cerrar sesión</button>

<!-- ==================== OVERLAY DE ACCESO (BLACK GLASS) ==================== -->
<div id="accessOverlay" role="dialog" aria-modal="true" aria-label="Acceso al sitio">
  <div class="overlay-card" role="document">
    <button class="closeOverlay" id="overlayClose" title="Cerrar">&times;</button>
    <img src="imagen1.jpg" alt="Logo PDC" class="logo" />
    <h2>Bienvenido a Worship PDC</h2>

    <div class="choiceBtns" id="loginChoices">
      <button id="visitorChoice">Entrar como Visitante</button>
      <button id="adminChoice">Login Admin</button>
    </div>

    <div id="visitorBox" class="formBox" aria-hidden="true">
      <input id="visitorPass" type="password" placeholder="Contraseña visitante" autocomplete="off" />
      <div class="actions">
        <button id="visitorSubmit">Entrar</button>
        <button id="visitorCancel">Volver</button>
      </div>
    </div>

    <div id="adminBox" class="formBox" aria-hidden="true">
      <input id="adminUser" type="text" placeholder="Usuario" autocomplete="off" />
      <input id="adminPass" type="password" placeholder="Contraseña" autocomplete="off" />
      <div class="actions">
        <button id="adminSubmit">Entrar</button>
        <button id="adminCancel">Volver</button>
      </div>
    </div>

    <div id="overlayError" class="smallMsg" aria-live="polite"></div>
  </div>
</div>
<!-- ==================== FIN OVERLAY ==================== -->

<!-- ==================== CONTENIDO PRINCIPAL ==================== -->
<div id="mainContent" class="hidden">
  <form id="lineForm" class="hidden">
    <div class="table-container">
      <table>
        <tr>
          <th>Video YouTube</th>
          <th>Cifrado PDF</th>
          <th>Tono</th>
          <th>Músicos</th>
          <th>Fecha</th>
          <th class="action-header">Acción</th>
        </tr>
        <tr>
          <td>
            <div style="display:flex;align-items:center;gap:5px;">
              <input type="url" id="videoURL" placeholder="https://..."/>
              <button type="button" id="searchVideoBtn">Buscar</button>
            </div>
          </td>
          <td><input type="file" id="fileUpload" accept="application/pdf"/></td>
          <td>
            <div style="display:flex;align-items:center;gap:5px;justify-content:center;">
              <input type="text" id="chords" placeholder="Ej: G - D - Em"/>
              <button type="button" id="toneBtn" class="tone-btn" title="Elegir tono">🎵</button>
            </div>
          </td>
          <td><button type="button" id="assignBtn" class="assign-green">Asignar músicos</button></td>
          <td><input type="date" id="customDate"/></td>
          <td class="action-cell"><button type="button" id="addLine">Agregar</button></td>
        </tr>
      </table>
    </div>
  </form>

  <h2 style="text-align:center;color:#4A90E2;">Lista multimedia</h2>
  <div id="calendarContainer"></div>
</div>
<!-- ==================== FIN CONTENIDO PRINCIPAL ==================== -->

<!-- Modales -->
<div id="toneModal" class="modal-backdrop"><div class="modal-card" id="toneContent"><h3>Seleccionar Tono</h3><div id="toneOptions" style="text-align:center;"></div><div style="text-align:center;margin-top:12px;"><button id="closeTone">Cerrar</button></div></div></div>
<div id="assignModal" class="modal-backdrop"><div class="modal-card" id="assignContent"><h3>Asignar Músicos</h3><div id="assignFields"></div><div style="text-align:center;margin-top:10px;"><button id="saveAssign">Guardar</button><button id="closeAssign">Cerrar</button></div></div></div>
<div id="searchModal" class="modal-backdrop"><div class="modal-card" id="searchContent"><h3>Buscar Video</h3><div id="videoList"></div><div style="text-align:center;margin-top:10px;"><button id="closeSearch">Cerrar</button></div></div></div>

<div id="editModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal-card" id="editContent" role="dialog" aria-modal="true" aria-labelledby="editTitle">
    <h3 id="editTitle">Modificar Canción</h3>
    <div class="edit-body">
      <label for="editVideo">Video YouTube</label>
      <input type="url" id="editVideo" placeholder="https://..." />
      <label for="editFile">Cifrado PDF (subir nuevo si deseas)</label>
      <input type="file" id="editFile" accept="application/pdf" />
      <label for="editChords">Tono</label>
      <input type="text" id="editChords" placeholder="Ej: G mayor" />
      <div id="editAssignFields"></div>
      <label for="editDate">Fecha</label>
      <input type="date" id="editDate" />
    </div>
    <div style="text-align:center;margin-top:8px;border-top:1px solid #eee;padding-top:8px;">
      <button id="saveEdit">Guardar cambios</button>
      <button id="cancelEdit">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal reproductor de video (se inyecta iframe al reproducir) -->
<div id="videoPlayerModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal-card" id="videoPlayerContent" role="dialog" aria-modal="true" aria-label="Reproductor de video">
    <!-- iframe se inyecta dinámicamente -->
  </div>
</div>

<!-- ==================== SCRIPT ==================== -->
<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhWpUt9cfxa21T8ijfUCIJuApWBBaBUJQ",
  authDomain: "worship-pdc.firebaseapp.com",
  projectId: "worship-pdc",
  storageBucket: "worship-pdc.appspot.com",
  messagingSenderId: "132891019857",
  appId: "1:132891019857:web:3d72cfe959a8d14cdf4670"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ======= CREDENCIALES LOCALES (temporal) ======= */
const VISITOR_PASSWORD = "pdc2025*";
const ADMIN_USER = "ADMINPDC";
const ADMIN_PASS = "worship1039";

/* ======= ESTADO DE SESIÓN ======= */
let loggedIn = false;
let visitorLogged = false;

/* ======= ELEMENTOS OVERLAY ======= */
const accessOverlay = document.getElementById("accessOverlay");
const visitorChoice = document.getElementById("visitorChoice");
const adminChoice = document.getElementById("adminChoice");
const visitorBox = document.getElementById("visitorBox");
const adminBox = document.getElementById("adminBox");
const visitorPass = document.getElementById("visitorPass");
const adminUser = document.getElementById("adminUser");
const adminPass = document.getElementById("adminPass");
const visitorSubmit = document.getElementById("visitorSubmit");
const visitorCancel = document.getElementById("visitorCancel");
const adminSubmit = document.getElementById("adminSubmit");
const adminCancel = document.getElementById("adminCancel");
const overlayError = document.getElementById("overlayError");
const overlayClose = document.getElementById("overlayClose");

const mainContent = document.getElementById("mainContent");
const lineForm = document.getElementById("lineForm");
const logoutBtn = document.getElementById("logoutBtn");

/* Mostrar/ocultar overlay */
function showOverlay(){ accessOverlay.style.display = "flex"; document.body.classList.add("overlayLocked"); overlayError.textContent=""; visitorBox.style.display='none'; adminBox.style.display='none'; document.getElementById("loginChoices").style.display='flex'; visitorPass.value=''; adminUser.value=''; adminPass.value=''; }
function hideOverlay(){ accessOverlay.style.display = "none"; document.body.classList.remove("overlayLocked"); }

/* Entrar como visitante/admin */
function enterAsVisitor(){ visitorLogged = true; loggedIn = false; hideOverlay(); mainContent.classList.remove("hidden"); lineForm.classList.add("hidden"); logoutBtn.classList.remove("hidden"); renderSongsIfExists(); localStorage.setItem("worship_role","visitor"); }
function enterAsAdmin(){ visitorLogged = false; loggedIn = true; hideOverlay(); mainContent.classList.remove("hidden"); lineForm.classList.remove("hidden"); logoutBtn.classList.remove("hidden"); renderSongsIfExists(); localStorage.setItem("worship_role","admin"); }

/* restaurar sesión */
function restoreSession(){ const role = localStorage.getItem("worship_role"); if(role==="admin") enterAsAdmin(); else if(role==="visitor") enterAsVisitor(); else showOverlay(); }
restoreSession();

/* overlay interactions */
visitorChoice.onclick = () => { document.getElementById("loginChoices").style.display = "none"; visitorBox.style.display = "flex"; adminBox.style.display = "none"; overlayError.textContent = ""; };
adminChoice.onclick = () => { document.getElementById("loginChoices").style.display = "none"; adminBox.style.display = "flex"; visitorBox.style.display = "none"; overlayError.textContent = ""; };
visitorCancel.onclick = () => { visitorBox.style.display = "none"; document.getElementById("loginChoices").style.display = "flex"; overlayError.textContent = ""; };
adminCancel.onclick = () => { adminBox.style.display = "none"; document.getElementById("loginChoices").style.display = "flex"; overlayError.textContent = ""; };
overlayClose.onclick = () => { visitorBox.style.display = "none"; adminBox.style.display = "none"; document.getElementById("loginChoices").style.display = "flex"; overlayError.textContent = ""; };

/* local validations */
visitorSubmit.onclick = () => {
  const pass = visitorPass.value.trim();
  if (!pass) { overlayError.textContent = "Ingresa la contraseña de visitante."; return; }
  if (pass === VISITOR_PASSWORD) enterAsVisitor(); else overlayError.textContent = "Contraseña visitante incorrecta.";
};
adminSubmit.onclick = () => {
  const user = adminUser.value.trim(); const pass = adminPass.value.trim();
  if (!user || !pass) { overlayError.textContent = "Ingresa usuario y contraseña."; return; }
  if (user === ADMIN_USER && pass === ADMIN_PASS) enterAsAdmin(); else overlayError.textContent = "Usuario o contraseña admin incorrectos.";
};

/* logout */
logoutBtn.onclick = () => {
  loggedIn = false; visitorLogged = false; localStorage.removeItem("worship_role");
  mainContent.classList.add("hidden"); lineForm.classList.add("hidden"); logoutBtn.classList.add("hidden");
  showOverlay();
};
</script>
</body>
</html>