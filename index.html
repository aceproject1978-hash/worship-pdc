<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Calendario Worship PDC</title>
<style>
/* ======= ESTILOS GENERALES ======= */
body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f9f9fb;color:#333;margin:15px;}
h1{text-align:center;color:#4A90E2;font-weight:700;margin-bottom:10px;text-shadow:1px 1px 2px rgba(74,144,226,0.5);user-select:none;}
.hidden{display:none;}
form,.calendar-block{width:100%;max-width:1100px;margin:0 auto 15px auto;}
table{width:100%;border-collapse:collapse;margin-top:5px;table-layout:fixed;}
table th:nth-child(1),table td:nth-child(1){width:18%;}
table th:nth-child(2),table td:nth-child(2){width:28%;}
table th:nth-child(3),table td:nth-child(3){width:12%;}
table th:nth-child(4),table td:nth-child(4){width:25%;}
table th:nth-child(5),table td:nth-child(5){width:10%;}
table th:nth-child(6),table td:nth-child(6){width:7%;}
th,td{border:1px solid #ccc;padding:5px 6px;text-align:center;vertical-align:middle;font-size:0.9em;}
th{background:linear-gradient(135deg,#4A90E2,#357ABD);color:white;font-weight:600;}
input[type=text],input[type=url],input[type=date],input[type=password],input[type=file]{width:95%;padding:4px 5px;border-radius:4px;border:1px solid #bbb;font-size:0.85em;box-sizing:border-box;}
button{background-color:#4A90E2;border:none;color:white;padding:5px 10px;font-size:0.85em;font-weight:600;border-radius:5px;cursor:pointer;transition:background-color 0.3s ease;}
button:hover{background-color:#357ABD;}
.assign-green{background-color:#28a745;color:white;font-weight:600;padding:6px 12px;border:none;border-radius:5px;cursor:pointer;transition:background-color 0.3s ease;display:block;margin:5px auto;}
.assign-green:hover{background-color:#218838;}
iframe{max-width:180px;height:90px;display:block;margin:4px auto;border-radius:6px;}
a{word-break:break-word;display:inline-block;font-size:0.8em;color:#274D87;text-decoration:none;}
a:hover{text-decoration:underline;}
.actions button{margin:2px 4px;font-size:0.75em;padding:3px 6px;border-radius:4px;}
.actions .edit{background-color:#F0AD4E;}
.actions .delete{background-color:#D9534F;}
#loginSection{max-width:360px;margin:50px auto;padding:20px;border-radius:10px;background:rgba(255,255,255,0.95);box-shadow:0 6px 20px rgba(0,0,0,0.15);border:1px solid rgba(74,144,226,0.3);text-align:center;}
#loginSection img{width:150px;margin-bottom:10px;}
#loginSection h2{margin-bottom:10px;color:#4A90E2;text-align:center;}
#errorMsg{color:#D9534F;text-align:center;margin-bottom:8px;}
.calendar-block{border:2px solid #4A90E2;border-radius:8px;background:#fff;margin-bottom:15px;box-shadow:0 0 8px rgba(74,144,226,0.1);}
.calendar-date{background:#4A90E2;color:white;padding:5px;border-radius:8px 8px 0 0;font-weight:600;text-align:center;font-size:1em;}
#loginBtn,#logoutBtn{position:absolute;top:15px;right:25px;}
#assignModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:1000;}
#assignContent{background:#fff;padding:15px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,0.25);width:280px;}
#assignContent h3{color:#4A90E2;text-align:center;margin-bottom:8px;}
.assign-item{margin:6px 0;display:flex;flex-direction:column;}
.assign-item label{font-weight:bold;margin-bottom:3px;}
.assign-item select{padding:4px;border:1px solid #ccc;border-radius:5px;font-size:0.85em;}
td:nth-child(4){white-space:pre-line;text-align:left;font-size:0.9em;}
#searchInput{width:95%;margin-top:5px;padding:4px 5px;border-radius:4px;border:1px solid #bbb;font-size:0.85em;display:none;}
</style>
</head>
<body>
<h1>Calendario Worship PDC</h1>
<button id="loginBtn">Login</button>
<button id="logoutBtn" class="hidden">Cerrar sesi칩n</button>

<div id="loginSection" class="hidden">
  <img src="imagen1.jpg" alt="Logo PDC" />
  <h2>Inicio de Sesi칩n</h2>
  <div id="errorMsg"></div>
  <input type="text" id="username" placeholder="Usuario" /><br><br>
  <input type="password" id="password" placeholder="Contrase침a" /><br><br>
  <button id="confirmLogin">Ingresar</button>
  <button id="cancelLogin">Cancelar</button>
</div>

<div id="mainContent">
  <form id="lineForm" class="hidden">
    <table>
      <tr>
        <th>Video YouTube</th>
        <th>Cifrado PDF</th>
        <th>Tono</th>
        <th>M칰sicos</th>
        <th>Fecha</th>
        <th class="action-header">Acci칩n</th>
      </tr>
      <tr>
        <td style="display:flex;align-items:center;gap:5px;">
          <input type="url" id="videoURL" placeholder="https://..."/>
          <button type="button" id="toggleSearch" title="Buscar video">游댌 Buscar</button>
        </td>
        <td><input type="file" id="fileUpload" accept="application/pdf"/></td>
        <td><input type="text" id="chords" placeholder="Ej: G - D - Em"/></td>
        <td><button type="button" id="assignBtn" class="assign-green">Asignar m칰sicos</button></td>
        <td><input type="date" id="customDate"/></td>
        <td class="action-cell"><button type="button" id="addLine">Agregar</button></td>
      </tr>
    </table>
    <input type="text" id="searchInput" placeholder="Buscar video por nombre o enlace...">
  </form>

  <h2 style="text-align:center;color:#4A90E2;">Lista multimedia</h2>
  <div id="calendarContainer"></div>
</div>

<!-- Modal -->
<div id="assignModal">
  <div id="assignContent">
    <h3>Asignar M칰sicos</h3>
    <div id="assignFields"></div>
    <div style="text-align:center;margin-top:10px;">
      <button id="saveAssign">Guardar</button>
      <button id="closeAssign">Cerrar</button>
    </div>
  </div>
</div>

<script type="module">
document.addEventListener("DOMContentLoaded", async () => {
  // 游댳 Cargar Firebase de forma din치mica
  const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
  const { getFirestore, collection, getDocs } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");

  const firebaseConfig = {
    apiKey: "AIzaSyDhWpUt9cfxa21T8ijfUCIJuApWBBaBUJQ",
    authDomain: "worship-pdc.firebaseapp.com",
    projectId: "worship-pdc",
    storageBucket: "worship-pdc.appspot.com",
    messagingSenderId: "132891019857",
    appId: "1:132891019857:web:3d72cfe959a8d14cdf4670"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------- LOGIN ----------
  const USERNAME = "ADMINPDC";
  const PASSWORD = "worship1039";
  let loggedIn = false;

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const loginSection = document.getElementById("loginSection");
  const confirmLogin = document.getElementById("confirmLogin");
  const cancelLogin = document.getElementById("cancelLogin");
  const errorMsg = document.getElementById("errorMsg");
  const lineForm = document.getElementById("lineForm");
  const calendarContainer = document.getElementById("calendarContainer");
  const toggleSearch = document.getElementById("toggleSearch");
  const searchInput = document.getElementById("searchInput");

  toggleSearch.style.display = "none"; // oculto si no est치 logueado

  loginBtn.onclick = () => { loginSection.classList.remove("hidden"); loginBtn.classList.add("hidden"); };
  cancelLogin.onclick = () => { loginSection.classList.add("hidden"); loginBtn.classList.remove("hidden"); };

  confirmLogin.onclick = () => {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();
    if (user === USERNAME && pass === PASSWORD) {
      loggedIn = true;
      loginSection.classList.add("hidden");
      logoutBtn.classList.remove("hidden");
      lineForm.classList.remove("hidden");
      toggleSearch.style.display = "inline-block";
      errorMsg.textContent = "";
      renderSongs();
    } else {
      errorMsg.textContent = "Usuario o contrase침a incorrectos.";
    }
  };

  logoutBtn.onclick = () => {
    loggedIn = false;
    logoutBtn.classList.add("hidden");
    loginBtn.classList.remove("hidden");
    lineForm.classList.add("hidden");
    toggleSearch.style.display = "none";
    renderSongs();
  };

  // ---------- BUSCADOR ----------
  toggleSearch.onclick = () => {
    searchInput.style.display = searchInput.style.display === "none" ? "block" : "none";
    searchInput.focus();
  };

  searchInput.addEventListener("input", async (e) => {
    const query = e.target.value.toLowerCase();
    if (!query) {
      renderSongs();
      return;
    }
    calendarContainer.innerHTML = "";
    const querySnapshot = await getDocs(collection(db, "songs"));
    let found = false;
    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      if (data.video?.toLowerCase().includes(query)) {
        addSongToDOM(data, docSnap.id);
        found = true;
      }
    });
    if (!found) calendarContainer.innerHTML = "<p style='text-align:center;color:#999;'>No se encontraron videos con ese criterio.</p>";
  });

  // ---------- FUNCIONES BASE ----------
  function renderSongs() {
    calendarContainer.innerHTML = "<p style='text-align:center;color:#666;'>Cargando canciones...</p>";
  }

  function addSongToDOM(data, id) {
    const div = document.createElement("div");
    div.classList.add("calendar-block");
    div.innerHTML = `
      <div class="calendar-date">${data.fecha || "Sin fecha"}</div>
      <div style="padding:10px;">
        <a href="${data.video}" target="_blank">${data.video}</a>
        <p><strong>Tono:</strong> ${data.tono || "N/A"}</p>
      </div>
    `;
    calendarContainer.appendChild(div);
  }
});
</script>
</body>
</html>
